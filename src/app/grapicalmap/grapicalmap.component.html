<div class="map-container">
  <!-- Product Selector -->
  <div class="product-selector">
    <div class="select-wrapper">
      <select [(ngModel)]="productCode" (change)="onProductChange($event)">
        <option *ngFor="let product of productCodes" [value]="product.value">
          {{ product.name }}
        </option>
      </select>
      <div class="select-arrow">▼</div>
    </div>
  </div>

  <!-- Altitude Slider for Wind/Temp -->
  <div *ngIf="isWindTempSelected" class="altitude-selector">
    <label for="altitude">Altitude: {{ selectedAltitude }}k ft</label>
    <input type="range" id="altitude" min="1" max="51" step="1" [value]="selectedAltitude"
      (input)="onAltitudeChange($event)" />
  </div>

  <!-- Map -->
  <div id="map"></div>

  <!-- Custom Legend (Vertical Gradient) -->
  <div *ngIf="displayedLegend.length > 0" class="custom-legend-vertical">
    <div class="legend-container">
      <div class="legend-values">
        <!-- Show high values at top (reverse order of gradient which is to top) -->
        <div *ngFor="let entry of displayedLegend.slice().reverse()" class="legend-label">
          {{ entry.value.replace(' mph', '') }}
        </div>
      </div>
      <div class="legend-bar" [style.background-image]="gradientStyle"></div>
    </div>
    <div class="legend-title">mph</div>
  </div>

  <!-- Time Control (Bottom Bar) -->
  <div *ngIf="forecastTimes.length > 0" class="bottom-time-control">
    <div class="control-group left">
      <button class="play-btn" (click)="toggleAnimation()" title="Play/Pause Animation">
        <span *ngIf="!isPlaying">▶</span>
        <span *ngIf="isPlaying">⏸</span>
      </button>

      <button class="nav-btn" (click)="selectPrevTime()" title="Previous Time Step">
        <span>⏮</span>
      </button>

      <!-- Date Selector -->
      <div class="date-selector">
        <button class="date-btn" (click)="toggleCalendar()">
          {{ selectedDate | date:'EEEE, MMM d' }}
          <span class="arrow">▼</span>
        </button>

        <div class="calendar-popup" *ngIf="showCalendar">
          <div class="calendar-grid">
            <button *ngFor="let date of uniqueDates" class="calendar-day" [class.active]="date === selectedDate"
              (click)="selectDate(date)">
              <span class="day-name">{{ date | date:'EEE' }}</span>
              <span class="day-num">{{ date | date:'d' }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="control-group center timeline-wrapper">
      <div class="timeline-track">
        <input type="range" [min]="0" [max]="currentDayTimes.length - 1" [value]="currentIndex"
          (input)="onTimelineInput($event)" class="timeline-slider">

        <div class="timeline-ticks">
          <!-- Show fewer ticks to avoid crowding -->
          <ng-container *ngFor="let time of currentDayTimes; let i = index">
            <div *ngIf="i % 4 === 0" class="tick" [style.left.%]="(i / (currentDayTimes.length - 1)) * 100">
              <div class="tick-mark"></div>
              <span class="tick-label">{{ formatTickTime(time) }}</span>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="control-group right">
      <button class="nav-btn" (click)="selectNextTime()" title="Next Time Step">
        <span>⏭</span>
      </button>
    </div>
  </div>
</div>